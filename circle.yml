machine:
  timezone: Asia/Tokyo
  environment:
    USERNAME: 'youyo'
    CIRCLE_PROJECT_REPONAME: 'recorder'
    GO15VENDOREXPERIMENT: 1

dependencies:
  pre:
    - |
      go get -v github.com/mitchellh/gox
      go get -v github.com/tcnksm/ghr
      go get -v github.com/Masterminds/glide
  override:
    - |
      glide up

test:
  override:
    - go test $(glide novendor)

deployment:
  release:
    branch: master
    commands:
      - |
        gox --osarch "linux/amd64" --output "dist/{{.Dir}}_{{.OS}}_{{.Arch}}"
        ghr -t ${GITHUB_TOKEN} -u $USERNAME -r $CIRCLE_PROJECT_REPONAME --replace `cat version.go | grep -w 'const Version string' | awk -F '"' '{print "v"$2}'` dist/
