test:
  box:
    id: youyo/recorder:test
    cmd: /bin/sh
  steps:
    - wercker/setup-go-workspace:
      package-dir: github.com/heptagon-inc/recorder
    - script:
      name: Update packages
      code: |-
        glide up
    - script:
      name: Tests
      code: |-
        go test $(glide novendor)

build:
  box:
    id: youyo/recorder:build
    cmd: /bin/sh
  steps:
    - wercker/setup-go-workspace:
      package-dir: github.com/heptagon-inc/recorder
    - script:
      name: Update packages
      code: |-
        glide up
    - script:
      name: Build
      code: |-
        GOOS=linux GOARCH=amd64 go build
        zip ${WERCKER_OUTPUT_DIR}/recorder_linux_amd64.zip recorder
        cat version.go | grep -w 'const Version string' | awk -F '"' '{print "v"$2}' > ${WERCKER_OUTPUT_DIR}/version.txt

deploy:
  box:
    id: youyo/recorder:release
    cmd: /bin/sh
  steps:
    - script:
      name: Release
      code: |-
        ghr -t ${GITHUB_TOKEN} -u heptagon-inc -r recorder --replace `cat version.txt` recorder_linux_amd64.zip
